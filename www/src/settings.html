<!DOCTYPE html>
<html lang="en">

<head>
  //= template/head.html
  <title>Settings</title>
  <style>


  </style>
</head>

<body>

  //= template/header.html
  <div class="cont">
    <div class="row">
      <div class="s12 m2 l2">
      </div>
      <div class="s12 m10 l9">
        <h2>Settings</h2>
        <div class="row">
          <div class="s12 m6 l6">
            <h3>Wi-Fi :</h3>
            <div class="row center">
              <div class="s12 m10">
                <div class="group">
                  <select id="wifi_mode" class="value">
                    <option value="0" disabled>Disable</option>
                    <option value="1" disabled>Station</option>
                    <option value="2" disabled>Access point</option>
                    <option value="3">STA and AP</option>
                  </select>
                  <span>Mode :</span>
                </div>
              </div>
            </div>
            <div class="row center">
              <div class="s12 m10">
                <div class="group">
                  <div class="search">
                    <input id="wifi_ssid" name="wifi_ssid" class="value" type="text" required=" " value="">
                    <label for="wifi_ssid">Name (SSID)</label><input id="search" type="submit" value="Scan">
                    <ul id="list" style="display:none;">
                    </ul>
                  </div>
                </div>
              </div>
              <div class="s12 m10">
                <div class="group"><input id="wifi_pass" type="password" class="value" required="" value="">
                  <label for="wifi_pass">Password</label>
                </div>
              </div>
            </div>
          </div>
          <div class="s12 m6 l6">
            <h3>Authentication :</h3>
            <div class="row center">
              <div class="s12 m10">
                <div class="group">
                  <select id="http_mode" class="value">
                    <option value="1">ON</option>
                    <option value="0">OFF</option>
                  </select>
                  <span>Mode :</span>
                </div>
              </div>
            </div>
            <div class="row center">
              <div class="s12 m10">
                <div class="group"><input id="http_login" type="text" class="value" required="" value="">
                  <label for="http_login">Login</label>
                </div>
              </div>
            </div>
            <div class="row center">
              <div class="s12 m10">
                <div class="group"><input id="http_pass" type="password" class="value" required="" value="">
                  <label for="http_pass">Password</label>
                </div>
              </div>
            </div>
          </div>
          <div class="s12 m6 l6">
            <h3>Server :</h3>
            <div class="row center">
              <div class="s12 m10">
                <div class="group"><input id="server_url" type="text" class="value" required="" value="">
                  <label for="server_url">Server url</label>
                </div>
              </div>
            </div>
            <div class="row center">
              <div class="s12 m10">
                <div class="group"><input id="server_port" type="number" class="value" required="" value="">
                  <label for="server_port">Port</label>
                </div>
              </div>
            </div>
          </div>
          <div class="s12 m6 l6">
            <h3>Device :</h3>
            <div class="row center">
              <div class="s12 m10">
                <div class="group"><input id="device_location" type="text" class="value" required="" value="">
                  <label for="device_location">Location name</label>
                </div>
              </div>
            </div>
            <div class="row center">
              <div class="s12 m10">
                <div class="group"><input id="device_id" type="text" required="" value="" disabled>
                  <label for="device_id" style="top: -20px;font-size: 14px;">Device ID</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row end">
          <div class="s12 m10">
            <div class="group"><button class="info" id="btn_save">Save</button></div>
          </div>
        </div><br>
        <div class="row">
          <div class="s12 end"></div>
        </div>
      </div>
    </div>
  </div>
  //= template/footer.html

  <script>
    function load() {
      // alert("is work")
    }

    function scan() {
      $('loader').classList.remove('hide')
      send("scan", {}, function (res) {
        if (res && res.length > 0) {
          var buf = '';
          res.forEach(function (item, i, res) {
            buf += '<li id="' + item.ssid + '"><b>' + item.ssid + '</b> rssi : ' + item.rssi + ' channel : ' + item.channel + '</li>';
          });
          $('list').innerHTML = buf;
        } else {
          $('list').innerHTML = '<li>No networks found. Try scanning again</li>';
        }
        $('list').style.display = 'block';
        $('loader').classList.add('hide')
      });
    }

    function save() {
      $('modal').classList.add("hide");
      var data = {};
      var values = document.getElementsByClassName('value');
      for (var i = 0, len = values.length | 0; i < len; i = i + 1 | 0) {
        var id = values[i].id;
        var value;
        if (values[i].tagName == "SELECT") {
          for (var s = 0; s < values[i].options.length | 0; s++) {
            if (values[i].options[s].selected) {
              value = values[i].options[s].value
              if (value !== '') data[id] = (/^-{0,1}\d+$/.test(value)) ? Number(value) : value
            }
          }
        }
        if (values[i].tagName == "INPUT") {
          value = values[i].value
          console.log()
          if (!values[i].disabled && value !== '') {
            data[id] = (/^-{0,1}\d+$/.test(value)) ? Number(value) : value
          } else {
            if (!values[i].disabled) {
              values[i].focus();
              return;
            }
          }
        }
      }
      console.log(data)
      $('modal').classList.remove("hide");
      send("settings", data, function (res) {
        console.log(res)
      }, "PUT");
    }

    function click(event) {
      if (event.target.tagName === "LI") {
        if (id === "m_yes") reboot();
        if (id === "btn_save") save();
        if (id) {
          $('wifi_ssid').value = id;
          $('wifi_pass').value = "";
          $('wifi_pass').focus();
          $('wifi_mode').value = "3";
        }
        $('list').style.display = 'none';
      } else {
        $('list').style.display = 'none';
      }
    }
    
  </script>
</body>

</html>