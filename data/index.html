<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta http-equiv="Content-Language" content="en"><meta name="msapplication-TileColor" content="#2d89ef"><meta name="theme-color" content="#4188c9"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta charset="UTF-8"><link href="style.css" rel="stylesheet"><script>var settings;function send(t,e,n){var o=new XMLHttpRequest;o.open(t.method||"POST",t.url||t,!0),o.setRequestHeader("Content-Type",t.content||"application/json; charset=utf-8"),o.addEventListener("load",function(){if(200===o.status)try{n&&n(JSON.parse(o.response))}catch(t){n&&n(!1)}else n&&n(!1)}),o.send(JSON.stringify(e))}function $(t){return document.getElementById(t)}function reboot(){send("reboot",{},function(t){}),$("modal").classList.add("hide")}function loadSettings(){send("settings",{},function(t){if($("loader").classList.add("hide"),t){for(key in t){var e=$(key);e&&(console.log(e.tagName),"SPAN"==e.tagName?e.innerHTML=t[key]:e.value=t[key])}settings=t}})}function logout(){document.cookie="id=",window.location=window.location.href.replace(/:\/\//,"://log:out@"),location.href="/"}window.onload=function(){loadSettings(),"function"==typeof load&&load(),document.body.addEventListener("click",function(t){"function"==typeof click&&click(t);var e=t.target.id;console.log(e),"search"===e&&scan(),"btn_exit"===e&&logout(),"m_no"!==e&&"m_close"!==e||$("modal").classList.add("hide")})}</script><title>Main</title><style></style></head><body><div id="loader" class="loader"></div><ul class="nav fix info" id="navbar"><li><a id="index" href="index.html" class="brand">Main</a></li><li><a id="settings" href="settings.html">Settings</a></li><li><a id="service" href="service.html">Service</a></li><li class="-exit"><a href="#" id="btn_exit">Exit</a></li><li class="-icon"><a href="#" onclick='document.getElementById("navbar").classList.toggle("res")'>&equiv;</a></li></ul><div id="modal" class="modal hide"><div class="m-cont"><div class="m-head"><span class="close" id="m_close">&times;</span> <span class="m-info">Attention!</span></div><div class="m-body"><p id="m_text">Save the settings and reload the module?</p></div><div class="m-foo"><button id="m_yes" class="info">Yes</button>&nbsp; <button id="m_no">No</button></div></div></div><div class="cont"><div class="row"><div class="s12 m2 l2"></div><div class="s12 m10 l-9"><h2>Main</h2><div class="row"><div class="s12 m10 l-9"><table id="table"><thead><tr><th>№</th><th>Card ID</th><th>Time</th><th>Type</th><th>Status</th></tr></thead><tbody></tbody></table></div></div></div></div></div><footer class="footer"><div class="row"><div class="s12 l11 of-l1"><ul><li class="p-4">ver: <span id="device_firmware"></span></li><li class="p-4"><a href="" target="_blank">Info</a></li></ul></div></div></footer><script>var count=1;function getInt(e){return e.reduce(function(e,n,t){return e|n<<8*(3-t)},0)}function codeHex2Txt(e){var n=e.toUpperCase(),t=n.length,o=n.substring(0,t-4),r=n.substring(t-4),s=parseInt(o,16),a=parseInt(r,16);return("000"+s).slice(-3)+","+("00000"+a).slice(-5)}function codeHex2Dec(e){var n=e.toUpperCase();return("0000000000"+parseInt(n,16)).slice(-10)}function codeDec2Hex(e){return("000000"+parseInt(e,10).toString(16)).slice(-6).toUpperCase()}function addTable(e,n,t,o,r){var s=document.getElementById("table").getElementsByTagName("tbody")[0].insertRow(0),a=s.insertCell(0),c=s.insertCell(1),i=s.insertCell(2),l=s.insertCell(3),u=s.insertCell(4),g=60*(new Date).getTimezoneOffset();d=new Date(1e3*(n+g)),a.innerHTML=count,c.innerHTML=codeHex2Txt(codeDec2Hex(e)),i.innerHTML=d.getDate()+"-"+d.getMonth()+"-"+d.getFullYear()+" "+d.getHours()+":"+d.getMinutes(),l.innerHTML=t?"Прибыл":"Убыл",u.innerHTML=r,count++}function startEvents(){ws=new WebSocket("ws://"+document.location.host+"/ws",["arduino"]),ws.binaryType="arraybuffer",ws.onopen=function(e){console.log("Connected")},ws.onclose=function(e){console.log("Disconnected")},ws.onerror=function(e){console.log("ws error",e),console.log("Error")},ws.onmessage=function(e){if(e.data instanceof ArrayBuffer)for(var n=new Uint8Array(e.data),t=0,o=0;o<n.length/16;o++){var r=getInt([n[t+3],n[t+2],n[t+1],n[t+0]]),s=getInt([n[t+7],n[t+6],n[t+5],n[t+4]]),a=getInt([n[t+11],n[t+10],n[t+9],n[t+8]]),c=n[t+12],i=n[t+13],l=n[t+14],u=n[t+15];addTable(r,s,c,u,i),console.log(r,s,a,c,i,l,u),t+=16}else"TXT:"+e.data}}function load(){$("index").classList.add("active"),startEvents()}</script></body></html>