var settings={};function send(e,t,n){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json"),i.addEventListener("load",function(){i.status<400?n(i.responseText):n(!1)}),i.send(JSON.stringify(t))}function listLink(){for(i=0;i<localStorage.length;i++){var e=localStorage.key(i);if("web.info"!=e){e=e.split("."),console.log(e);var t=document.createElement("a");t.href="plugin.html?plugin="+e[0],t.style.color="black",t.innerHTML='<li class="lg-i">'+e[0]+"</li>",list.appendChild(t)}}}function loadURl(e){var t;-1!=e.indexOf(".js")?((t=document.createElement("script")).src=e,t.async=!1):((t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e)),document.head.appendChild(t),t.onload=function(){document.getElementById("loader").classList.add("hide")},t.onerror=function(){}}function card(e){var i='<div class="card hover"><div class="card-image"'+(e.info.img?'style="background: url('+e.info.img+') center center / cover no-repeat;"':"")+'></div><div class="card-content"><span title="Module name" class="card-title">'+e.info.name+'</span><div class="tia run"></div><div class="group btnInfo"><input title="autostart module" '+(e.init.run?"checked ":"")+'type="checkbox" id="run" /><label for="run"></label></div><span class="vers" title="Installed version">version <b>'+e.info.version+"</b></span><p>";return"object"==typeof e.info.page?e.info.page.forEach(function(e,t,n){i+='<a title="/'+e+'" target="_blank" href="'+e+'">link </a>'}):i+='<a title="/'+e.info.page+'" target="_blank" href="'+e.info.page+'">link</a>',i+="</p><p><b>Description : </b>"+e.info.description+"</p><p><b>Modules : </b>"+e.info.modules.join(", ")+'</p><span class="git b"><a target="_blank" href="'+e.info.repository.url+'">GitHub</a></span></div></div>'}function create(e,t,n){var i=document.createElement("div");i.className=n,i.innerHTML=e,document.getElementById(t).appendChild(i)}function text(e,t){return'<div class="group"><input id="'+e.id+'" type="text" required="" value="'+e.valInit+'"><label for="'+e.name+'">'+e.name+"</label></div>"}function number(e){return'<div class="group"><input id="'+e.id+'" title="min='+e.min+", max="+e.max+'" type="number" min="'+e.min+'" max="'+e.max+'" required="" value="'+e.valInit+'"><label for="'+e.id+'">'+e.name+"</label></div>"}function select(i){var o='  <div class="group"><select id="'+i.id+'" name="'+i.id+'">';return i.values.forEach(function(e,t,n){e===i.valInit?o+='<option selected value="'+e+'">'+e+"</option>":o+='<option value="'+e+'">'+e+"</option>"}),o+="</select><span>"+i.name+"</span></div>"}function load(i){var e=i.info.native;console.log(e),e.forEach(function(e,t){if(0!==t){var n=e;n.valInit=i.init[e.id],"number"===n.type?create(number(n),"plugin","s6"):"select"===n.type?create(select(n),"plugin","s6"):create(text(n),"plugin","s6")}})}function validate(e){var t=document.getElementById(e),n=t.value;if(0===n.length)return!1;if("number"===t.type){var i=+t.getAttribute("min"),o=+t.getAttribute("max");if(n<i||o<n)return!1}return!0}function save(){var e={},t=!0;for(var n in settings.init){var i=document.getElementById(n);validate(n)||(alert("Error in input field "+n),t=!1),"checkbox"===i.type?e[n]=i.checked:"number"===i.type?e[n]=+i.value:"select-one"===i.type?e[n]=isNaN(+i.value)?i.value:+i.value:e[n]=i.value}if(t){e.Fname=settings.info.name+".init";var o=document.getElementById("saveInfo");o.innerHTML="Saving",send("init_settings.lua",{save:e},function(e){o.innerHTML=e?"Saved":"Error",console.log(e),setTimeout(function(){o.innerHTML="Save",reboot(!0)},2e3)})}console.log(e)}function def(){var e=settings.info.native;console.log(e),e.forEach(function(e,t){if(console.log(e.val),"checkbox"===e.type)console.log(e.id),document.getElementById(e.id).checked=e.val;else if("select"===e.type){var n=document.getElementById(e.id);for(t=0;t<n.options.length;t++)n.options[t].selected=!1,n.options[t].value==e.val&&(n.options[t].selected=!0)}else document.getElementById(e.id).value=e.val})}function del(){send("init_settings.lua",{del:settings.info.files},function(e){console.log(e),document.getElementById("loader").classList.remove("hide"),e&&(localStorage.removeItem(settings.info.name+".info"),setTimeout(function(){location.href="/index.html"},1e3))})}function logout(){document.cookie="id=",location.href="/login.html"}function reboot(e){e?document.getElementById("Modal").style.display="block":(document.getElementById("loader").classList.remove("hide"),send("web_control.lua",{reboot:!0},function(e){document.getElementById("Modal").style.display="none",setTimeout(function(){location.href="/"},1e4)}))}function modClose(){document.getElementById("Modal").style.display="none"}window.onload=function(){listLink(),document.getElementById("loader").classList.add("hide");var t=new URL(window.location.href).searchParams.get("plugin");t&&send(t+".init",{},function(e){if(e){try{settings.init=JSON.parse(e),settings.info=JSON.parse(localStorage.getItem(t+".info"))}catch(e){return void console.log(e)}load(settings),create(card(settings),"info","s12"),settings.info.script?setTimeout(function(){loadURl(settings.info.script)},2e3):document.getElementById("loader").classList.add("hide")}})};